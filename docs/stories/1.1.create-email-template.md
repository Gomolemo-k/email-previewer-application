# Story 1.1: Create Email Template

## Status

Draft

## Story

**As a** Content Creator,
**I want** to create a new email template,
**so that** I can design emails for my campaigns.

## Acceptance Criteria

1. User can navigate to a "Create Template" page.
2. User can enter a name for the template.
3. User can enter the HTML content for the template.
4. User can save the template.
5. User is redirected to the template list page after saving.

## Tasks / Subtasks

- [ ] Task 1 (AC: 1) - Create the "Create Template" page route and basic layout
  - [ ] Subtask 1.1 - Define the Next.js page component at `src/app/email/create/page.tsx`
  - [ ] Subtask 1.2 - Add a basic layout with a form for template name and content
- [ ] Task 2 (AC: 2, 3) - Implement the email template editor UI component
  - [ ] Subtask 2.1 - Create `EmailTemplateEditor` component at `src/app/email/components/EmailTemplateEditor.tsx`
  - [ ] Subtask 2.2 - Add input field for template name
  - [ ] Subtask 2.3 - Add a text area or rich text editor for HTML content
- [ ] Task 3 (AC: 4) - Implement the save template functionality
  - [ ] Subtask 3.1 - Create a Server Action in `src/actions/email-actions.ts` to save the template to the database
  - [ ] Subtask 3.2 - Connect the form submission to the Server Action
  - [ ] Subtask 3.3 - Handle success and error responses from the Server Action
- [ ] Task 4 (AC: 5) - Implement redirection after saving
  - [ ] Subtask 4.1 - Redirect the user to the template list page (`/email`) after a successful save

## Dev Notes

### Previous Story Insights

This is the first story, so there are no previous story insights.

### Data Models

- **EmailTemplate**
  - id: string - Unique identifier for the template.
  - name: string - Name of the template.
  - content: string - The HTML content of the email template.
  - userId: string - Foreign key to the user who created the template.
  - createdAt: timestamp - When the template was created.
  - updatedAt: timestamp - When the template was last updated.
  [Source: architecture/architecture.md#data-models-and-schema-changes]

### API Specifications

- **Save Template**
  - Method: POST
  - Endpoint: `/api/email/templates` (via Server Action)
  - Purpose: Create a new email template.
  - Integration: Integrates with the EmailTemplate data model.
  [Source: architecture/architecture.md#integration-approach]

### Component Specifications

- **EmailTemplateEditor**
  - Responsibility: Allows users to create and edit email templates.
  - Integration Points: Integrates with the database via Server Actions for saving templates. Uses Radix UI and TailwindCSS for the UI.
  - Key Interfaces:
    - onSaveTemplate(templateData)
    - onPreviewTemplate(templateData)
  - Dependencies:
    - **Existing Components:** None directly, but uses existing UI primitives.
    - **New Components:** EmailPreviewPane
  - Technology Stack: React, TypeScript, TailwindCSS, Radix UI
  [Source: architecture/architecture.md#new-components]

### File Locations

- Page: `src/app/email/create/page.tsx`
- Component: `src/app/email/components/EmailTemplateEditor.tsx`
- Server Action: `src/actions/email-actions.ts`
- Database Schema: `src/db/schema/email-templates.ts`
[Source: architecture/architecture.md#source-tree-integration]

### Testing Requirements

- **Unit Tests for New Components**
  - Framework: Jest or the existing test framework.
  - Location: `src/app/email/components/__tests__/`
  - Coverage Target: 80%+
  - Integration with Existing: Follow existing test patterns.
  [Source: architecture/architecture.md#unit-tests-for-new-components]

- **Integration Tests**
  - Scope: Test the interaction between new components and Server Actions.
  - Existing System Verification: Ensure existing functionality remains intact.
  - New Feature Testing: Test the new email previewing feature thoroughly.
  [Source: architecture/architecture.md#integration-tests]

### Technical Constraints

- Must maintain compatibility with existing Next.js 15 and React 19 setup.
- Must integrate with existing Drizzle ORM and PostgreSQL database.
- Must work within the existing authentication system (Better Auth).
- Must adhere to the existing internationalization setup (next-intl).
- Must follow the established directory structure and coding conventions.
[Source: architecture/architecture.md#identified-constraints]

### Testing

- **Unit Tests for New Components**
  - Framework: Jest or the existing test framework.
  - Location: `src/app/email/components/__tests__/`
  - Coverage Target: 80%+
  - Integration with Existing: Follow existing test patterns.
  [Source: architecture/architecture.md#unit-tests-for-new-components]

- **Integration Tests**
  - Scope: Test the interaction between new components and Server Actions.
  - Existing System Verification: Ensure existing functionality remains intact.
  - New Feature Testing: Test the new email previewing feature thoroughly.
  [Source: architecture/architecture.md#integration-tests]

## Change Log

| Date | Version | Description | Author |
| :--- | :--- | :--- | :--- |
| 2025-09-15 | 1.0 | Initial draft of the story | Scrum Master (Bob) |